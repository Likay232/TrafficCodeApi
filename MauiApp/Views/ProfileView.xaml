<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModel="clr-namespace:MauiApp.ViewModels"
             xmlns:dto1="clr-namespace:MauiApp.Infrastructure.Models.DTO;assembly=MauiApp.Infrastructure"
             x:Class="MauiApp.Views.ProfileView"
             x:DataType="viewModel:ProfileViewModel"
             BackgroundColor="#F5F6F8">

    <Grid>
        <ScrollView IsVisible="{Binding NoInfo, Converter={StaticResource InvertBoolConverter}}">
            <VerticalStackLayout Padding="16" Spacing="20">

                <Frame BackgroundColor="White"
                       CornerRadius="12"
                       HasShadow="True"
                       Padding="16">

                    <VerticalStackLayout Spacing="4">

                        <HorizontalStackLayout Spacing="6">
                            <Label Text="{Binding Model.FirstName}"
                                   FontSize="18"
                                   FontAttributes="Bold" />

                            <Label Text="{Binding Model.LastName}"
                                   FontSize="18"
                                   FontAttributes="Bold" />
                        </HorizontalStackLayout>

                        <HorizontalStackLayout Spacing="6">
                            <Label Text="{Binding Model.Username}"
                                   FontSize="14"
                                   TextColor="#777" />
                        </HorizontalStackLayout>

                    </VerticalStackLayout>
                </Frame>

                <Frame BackgroundColor="White"
                       CornerRadius="12"
                       HasShadow="True"
                       Padding="14"
                       Margin="4">

                    <VerticalStackLayout Spacing="10">

                        <Grid ColumnDefinitions="*,Auto"
                              ColumnSpacing="8">

                            <Label Text="Экзамены"
                                   FontAttributes="Bold"
                                   LineBreakMode="WordWrap"
                                   Grid.Column="0" />

                            <Frame BackgroundColor="#E3F2FD"
                                   Padding="6,2"
                                   CornerRadius="12"
                                   Grid.Column="1"
                                   VerticalOptions="Start">

                                <Label Text="{Binding Model.ExamStatistic.Solved, StringFormat='Сдано: {0}'}"
                                       FontSize="12"
                                       TextColor="#1565C0" />
                            </Frame>

                        </Grid>

                        <VerticalStackLayout Spacing="4">
                            <HorizontalStackLayout>
                                <Label Text="Среднее количество ошибок:  "
                                       FontSize="12"
                                       TextColor="#555"
                                       HorizontalOptions="StartAndExpand" />

                                <Label
                                    Text="{Binding Model.ExamStatistic.AverageMistakesAmount, StringFormat='{0:F0}'}"
                                    FontSize="12"
                                    TextColor="#555" />
                            </HorizontalStackLayout>
                        </VerticalStackLayout>

                        <VerticalStackLayout Spacing="4">
                            <HorizontalStackLayout>
                                <Label Text="Решено верно:  "
                                       FontSize="12"
                                       TextColor="#555"
                                       HorizontalOptions="StartAndExpand" />

                                <Label Text="{Binding Model.ExamStatistic.CorrectPercent, StringFormat='{0:F0}%'}"
                                       FontSize="12"
                                       TextColor="#555" />
                            </HorizontalStackLayout>

                            <ProgressBar
                                Progress="{Binding Model.ExamStatistic.CorrectPercent, Converter={StaticResource PercentToProgressConverter}}"
                                HeightRequest="6"
                                BackgroundColor="#E6F4EA"
                                ProgressColor="#2E7D32" />
                        </VerticalStackLayout>

                    </VerticalStackLayout>
                </Frame>

                <Label Text="Статистика по темам"
                       FontSize="18"
                       FontAttributes="Bold"
                       Margin="4,0" />

                <CollectionView ItemsSource="{Binding Model.ThemesStatistics}"
                                SelectionMode="None">

                    <CollectionView.ItemsLayout>
                        <GridItemsLayout Orientation="Vertical"
                                         Span="1" />
                    </CollectionView.ItemsLayout>

                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="dto1:ThemesStatistic">
                            <Frame BackgroundColor="White"
                                   CornerRadius="12"
                                   HasShadow="True"
                                   Padding="14"
                                   Margin="4">

                                <VerticalStackLayout Spacing="10">

                                    <Grid ColumnDefinitions="*,Auto"
                                          ColumnSpacing="8">

                                        <Label Text="{Binding ThemeName}"
                                               FontAttributes="Bold"
                                               LineBreakMode="WordWrap"
                                               Grid.Column="0" />

                                        <Frame BackgroundColor="#E3F2FD"
                                               Padding="6,2"
                                               CornerRadius="12"
                                               Grid.Column="1"
                                               VerticalOptions="Start">

                                            <Label Text="{Binding Level, StringFormat='Уровень {0}'}"
                                                   FontSize="12"
                                                   TextColor="#1565C0" />
                                        </Frame>

                                    </Grid>

                                    <VerticalStackLayout Spacing="4">
                                        <HorizontalStackLayout>
                                            <Label Text="Решено заданий "
                                                   FontSize="12"
                                                   TextColor="#555"
                                                   HorizontalOptions="StartAndExpand" />

                                            <Label Text="{Binding SolvedPercent, StringFormat='{0:F0}%'}"
                                                   FontSize="12"
                                                   TextColor="#555" />
                                        </HorizontalStackLayout>

                                        <ProgressBar
                                            Progress="{Binding SolvedPercent, Converter={StaticResource PercentToProgressConverter}}"
                                            HeightRequest="6"
                                            BackgroundColor="#EEE"
                                            ProgressColor="#1976D2" />
                                    </VerticalStackLayout>

                                    <VerticalStackLayout Spacing="4">
                                        <HorizontalStackLayout>
                                            <Label Text="Правильные ответы "
                                                   FontSize="12"
                                                   TextColor="#555"
                                                   HorizontalOptions="StartAndExpand" />

                                            <Label Text="{Binding SolvedCorrectPercent, StringFormat='{0:F0}%'}"
                                                   FontSize="12"
                                                   TextColor="#555" />
                                        </HorizontalStackLayout>

                                        <ProgressBar
                                            Progress="{Binding SolvedCorrectPercent, Converter={StaticResource PercentToProgressConverter}}"
                                            HeightRequest="6"
                                            BackgroundColor="#E6F4EA"
                                            ProgressColor="#2E7D32" />
                                    </VerticalStackLayout>

                                </VerticalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>

                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>

        <Label Text="Нет сети"
               FontSize="18"
               TextColor="#555"
               HorizontalOptions="Center"
               VerticalOptions="Center"
               IsVisible="{Binding NoInfo}" />

    </Grid>
</ContentPage>